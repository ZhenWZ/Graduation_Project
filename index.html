<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graduation Project</title>
    <!-- <link rel="stylesheet" href="style.css"> -->
    <style>
        /* 确保视频覆盖层不会导致灰色遮罩 */
        .video-overlay {
            background-color: transparent !important;
            pointer-events: none;
        }
        
        /* 确保视频能正常显示 */
        video {
            z-index: 2;
            position: relative;
        }
    </style>
    <script>
        // 设置根路径
        const isGitHub = window.location.hostname.includes('github.io');
        const rootPath = isGitHub ? "/Graduation_Project" : "";
        document.write(`<link rel="stylesheet" href="${isGitHub ? '/Graduation_Project/style.css' : 'style.css'}">`);
        // 添加调试信息
        console.log('Script loaded');
        console.log('Current hostname:', window.location.hostname);
        console.log('Is GitHub Pages:', isGitHub);
        console.log('Root path:', rootPath);
        
        // 在页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded');
            
            // 获取所有视频元素
            const videos = document.querySelectorAll('video source');
            console.log('Found videos:', videos.length);
            
            // 移除所有可能导致灰色覆盖的视频覆盖层
            document.querySelectorAll('.video-overlay').forEach(overlay => {
                overlay.style.backgroundColor = 'transparent';
                overlay.style.pointerEvents = 'none';
                overlay.style.display = 'none'; // 完全隐藏覆盖层
            });
            
            // 在GitHub Pages上检查所有视频文件
            if (isGitHub) {
                console.log("检查GitHub Pages上的所有视频文件:");
                const allVideoPaths = [
                    "/Graduation_Project/assets/chapter3/31_voca_name.mp4",
                    "/Graduation_Project/assets/chapter3/31_biwi_name.mp4",
                    "/Graduation_Project/assets/chapter3/32_voca_name.mp4",
                    "/Graduation_Project/assets/chapter3/32_biwi_name.mp4",
                    "/Graduation_Project/assets/chapter3/33_genetal.mp4",
                    "/Graduation_Project/assets/chapter3/34_english.mp4",
                    "/Graduation_Project/assets/chapter3/34_chinese.mp4",
                    "/Graduation_Project/assets/chapter3/34_japanese.mp4",
                    "/Graduation_Project/assets/chapter4/41_processdata.mp4",
                    "/Graduation_Project/assets/chapter4/42_facial_micro.mp4",
                    "/Graduation_Project/assets/chapter4/43_method_compare.mp4",
                    "/Graduation_Project/assets/chapter4/44_cfg_name.mp4",
                    "/Graduation_Project/assets/chapter5/51_man_woman.mp4",
                    "/Graduation_Project/assets/chapter5/52_name.mp4",
                    "/Graduation_Project/assets/chapter5/53_name.mp4"
                ];
                
                // 检查所有文件
                Promise.all(allVideoPaths.map(path => 
                    fetch(path, { method: 'HEAD' })
                        .then(response => ({ path, status: response.status, ok: response.ok }))
                        .catch(error => ({ path, error: error.message, ok: false }))
                )).then(results => {
                    console.table(results);
                    const missingFiles = results.filter(r => !r.ok);
                    if (missingFiles.length > 0) {
                        console.error(`❌ ${missingFiles.length} 个视频文件缺失!`);
                    } else {
                        console.log("✅ 所有视频文件已找到!");
                    }
                });
            }
            
            // 为每个视频添加调试信息
            videos.forEach((video, index) => {
                const currentSrc = video.getAttribute('src');
                // 添加时间戳避免缓存问题
                const timestamp = new Date().getTime();
                // 修复：移除额外的斜杠，正确构建GitHub Pages路径
                const finalSrc = isGitHub ? `${rootPath}/${currentSrc}?t=${timestamp}` : `${currentSrc}?t=${timestamp}`;
                console.log(`Setting video source ${index + 1}:`, finalSrc);
                video.setAttribute('src', finalSrc);
                
                // 检查视频文件是否存在
                fetch(finalSrc, { method: 'HEAD' })
                    .then(response => {
                        if (response.ok) {
                            console.log(`✅ Video file exists: ${finalSrc}`);
                        } else {
                            console.error(`❌ Video file NOT found (${response.status}): ${finalSrc}`);
                        }
                    })
                    .catch(error => {
                        console.error(`❌ Error checking video file: ${finalSrc}`, error);
                    });
                
                // 添加错误处理
                const videoElement = video.parentElement;
                videoElement.addEventListener('error', function(e) {
                    console.error(`Video ${index + 1} error:`, {
                        error: videoElement.error,
                        src: finalSrc,
                        event: e
                    });
                    
                    // 尝试使用不同的方法重新加载视频
                    console.log(`尝试重新加载视频 ${index + 1} 使用备用方法...`);
                    
                    // 方法1: 使用完整的URL
                    const absoluteUrl = isGitHub ? 
                        `https://ningxinj.github.io${rootPath}/${currentSrc}?retry=1&t=${timestamp}` : 
                        `${window.location.origin}/${currentSrc}?retry=1&t=${timestamp}`;
                    
                    console.log(`尝试备用URL: ${absoluteUrl}`);
                    
                    // 创建新的source元素
                    const newSource = document.createElement('source');
                    newSource.setAttribute('src', absoluteUrl);
                    newSource.setAttribute('type', 'video/mp4');
                    
                    // 清除当前的source元素
                    while (videoElement.firstChild) {
                        videoElement.removeChild(videoElement.firstChild);
                    }
                    
                    // 添加新的source元素
                    videoElement.appendChild(newSource);
                    
                    // 重新加载视频
                    videoElement.load();
                }, true); // 捕获阶段
                
                // 添加加载状态监听
                videoElement.addEventListener('loadeddata', function() {
                    console.log(`Video ${index + 1} loaded data`);
                });
                
                videoElement.addEventListener('loadedmetadata', function() {
                    console.log(`Video ${index + 1} loaded metadata`);
                });
                
                videoElement.addEventListener('canplay', function() {
                    console.log(`Video ${index + 1} can play`);
                });
                
                videoElement.addEventListener('stalled', function() {
                    console.log(`Video ${index + 1} stalled`);
                });
                
                videoElement.addEventListener('suspend', function() {
                    console.log(`Video ${index + 1} suspended`);
                });
            });
        });
        
        // 添加页面加载错误处理
        window.addEventListener('error', function(e) {
            console.error('Page error:', e);
        });
    </script>
</head>
<body>
    <section id="chapter3">
        <h2>Chapter 3</h2>
        <div class="video-container">
            <div class="video-item">
                <h3>基于音素-视素映射的两阶段网格数据集拟合对比实验</h3>
                <div class="video-wrapper">
                    <video class="video-large" width="640" controls controlsList="nodownload" disablePictureInPicture preload="auto">
                        <source src="assets/chapter3/31_voca_name.mp4" type="video/mp4">
                    </video>
                    <div class="video-overlay"></div>
                </div>
                <p class="video-caption">VOCASET-VISM数据集拟合结果</p>
                <div class="video-wrapper">
                    <video class="video-large" width="640" controls controlsList="nodownload" disablePictureInPicture preload="auto">
                        <source src="assets/chapter3/31_biwi_name.mp4" type="video/mp4">
                    </video>
                    <div class="video-overlay"></div>
                </div>
                <p class="video-caption">BIWI-VISM数据集拟合结果</p>
            </div>
            <div class="video-item">
                <h3>VOCASET-VISM与BIWI-VISM数据集网络对比结果可视化结果</h3>
                <div class="video-wrapper">
                    <video class="video-large" width="640" controls controlsList="nodownload" disablePictureInPicture preload="auto">
                        <source src="assets/chapter3/32_voca_name.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="video-overlay"></div>
                </div>
                <p class="video-caption">VOCASET-VISM数据集方法对比</p>
                <div class="video-wrapper">
                    <video class="video-large" width="640" controls controlsList="nodownload" disablePictureInPicture preload="auto">
                        <source src="assets/chapter3/32_biwi_name.mp4" type="video/mp4">
                    </video>
                    <div class="video-overlay"></div>
                </div>
                <p class="video-caption">BIWI-VISM数据集方法对比</p>
            </div>
        </div>
        <div class="video-container">
            <div class="video-item">
                <h3>泛化性对比结果可视化</h3>
                <div class="video-wrapper">
                    <video class="video-large" width="640" controls controlsList="nodownload" disablePictureInPicture preload="auto">
                        <source src="assets/chapter3/33_genetal.mp4" type="video/mp4">
                    </video>
                    <div class="video-overlay"></div>
                </div>
            </div>
        </div>
        <div class="video-container">
            <div class="video-item">
                <h3>泛化性多语言测试</h3>
                <div class="sequential-videos">
                    <div class="video-with-caption">
                        <div class="video-wrapper">
                            <video class="video-small" width="640" controls controlsList="nodownload" disablePictureInPicture preload="auto">
                                <source src="assets/chapter3/34_english.mp4" type="video/mp4">
                            </video>
                            <div class="video-overlay"></div>
                        </div>
                        <p class="video-caption">英语测试</p>
                    </div>
                    <div class="video-with-caption">
                        <div class="video-wrapper">
                            <video class="video-small" width="640" controls controlsList="nodownload" disablePictureInPicture preload="auto">
                                <source src="assets/chapter3/34_chinese.mp4" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                            <div class="video-overlay"></div>
                        </div>
                        <p class="video-caption">中文测试</p>
                    </div>
                    <div class="video-with-caption">
                        <div class="video-wrapper">
                            <video class="video-small" width="640" controls controlsList="nodownload" disablePictureInPicture preload="auto">
                                <source src="assets/chapter3/34_japanese.mp4" type="video/mp4">
                            </video>
                            <div class="video-overlay"></div>
                        </div>
                        <p class="video-caption">日语测试</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="chapter4">
        <h2>Chapter 4</h2>
        <div class="video-container">
            <div class="video-item">
                <h3>Blend-TFHP数据处理结果</h3>
                <div class="video-wrapper">
                    <video class="video-small" width="640" controls controlsList="nodownload" disablePictureInPicture preload="auto">
                        <source src="assets/chapter4/41_processdata.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="video-overlay"></div>
                </div>
            </div>
            <div class="video-item">
                <h3>面部表现Unreal Engine MetaHuman可视化</h3>
                <div class="video-wrapper">
                    <video class="video-large" width="640" controls controlsList="nodownload" disablePictureInPicture preload="auto">
                        <source src="assets/chapter4/42_facial_micro.mp4" type="video/mp4">
                    </video>    
                    <div class="video-overlay"></div>
                </div>
            </div>
        </div>
        <div class="video-container">
            <div class="video-item">
                <h3>不同方法对比定性分析可视化及结果分析</h3>
                <div class="video-wrapper">
                    <video class="video-large" width="640" controls controlsList="nodownload" disablePictureInPicture preload="auto">
                        <source src="assets/chapter4/43_method_compare.mp4" type="video/mp4">
                    </video>
                    <div class="video-overlay"></div>
                </div>
            </div>
        </div>
        <div class="video-container">
            <div class="video-item">
                <h3>无分类指导器权重大小控制探究</h3>
                <div class="video-wrapper">
                    <video class="video-large" width="640" controls controlsList="nodownload" disablePictureInPicture preload="auto">
                        <source src="assets/chapter4/44_cfg_name.mp4" type="video/mp4">
                    </video>
                    <div class="video-overlay"></div>
                </div>
            </div>
        </div>
    </section>

    <section id="chapter5">
        <h2>Chapter 5</h2>
        <div class="video-container">
            <div class="video-item">
                <h3>三维网格驱动的二维肖像动画生成结果可视化</h3>
                <div class="video-wrapper">
                    <video class="video-medium" width="640" controls controlsList="nodownload" disablePictureInPicture preload="auto">
                        <source src="assets/chapter5/51_man_woman.mp4" type="video/mp4">
                    </video>
                    <div class="video-overlay"></div>
                </div>
            </div>
            <div class="video-item">
                <h3>对比方法可视化</h3>
                <div class="video-wrapper">
                    <video class="video-medium" width="640" controls controlsList="nodownload" disablePictureInPicture preload="auto">
                        <source src="assets/chapter5/52_name.mp4" type="video/mp4">
                    </video>
                    <div class="video-overlay"></div>
                </div>
            </div>
        </div>
        <div class="video-container">
            <div class="video-item">
                <h3>结果可视化及分析</h3>
                <div class="video-wrapper">
                    <video class="video-medium" width="640" controls controlsList="nodownload" disablePictureInPicture preload="auto">
                        <source src="assets/chapter5/53_name.mp4" type="video/mp4">
                    </video>
                    <div class="video-overlay"></div>
                </div>
            </div>
        </div>
    </section>
</body>
</html>
